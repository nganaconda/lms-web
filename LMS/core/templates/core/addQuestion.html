<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add a Question</title>
    <link rel="stylesheet" href="/static/css/addQuestion_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-container">
            <button class="home-button" onclick="location.href='/portfolio/'">
                <img src="/static/home.png" alt="Home">
            </button>
            <div class="header-right">
                <button onclick="location.href='/profile/'">{{ username }}</button>
                <button onclick="location.href='/'">Logout</button>
            </div>
        </div>
    </header>
    <div class="main-container">
        <aside>
            <div class="logo-container">
                <img src="/static/logo.png" alt="Logo">
            </div>
            <nav>
                <ul>
                    <li><a href="/portfolio/">My Tests</a></li>
                    <li><a href="/questions/">My Test Questions</a></li>
                    <!-- Dropdown list of tests -->
                </ul>
            </nav>
        </aside>
        <main>
            <section class="add_question">
                <h1>Add a Question</h1>
                <form method="post">
                    {% csrf_token %}
                    
                    <div>
                        <h2>Question Details</h2>
                        {{ form.non_field_errors }}
                        <div>
                            <label for="id_question">Question:</label>
                            {{ form.question }}
                        </div>
                        <div>
                            <label for="id_type">Type:</label>
                            {{ form.type }}
                        </div>
                        <div>
                            <label for="id_difficulty">Difficulty:</label>
                            <input type="number" id="id_difficulty" name="difficulty" min="1" max="4">
                        </div>
                    </div>
                
                    <div>
                        <h2>Attributes</h2>
                        {{ formset.management_form }}
                        <div id="attributes-container">
                            {% for subform in formset %}
                                <div class="attribute-form">
                                    <div class="attribute-input-container">
                                        {{ subform.answer.label_tag }} {{ subform.answer }}
                                        <button type="button" class="remove-attribute"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <button type="button" id="add-attribute">Add Another Attribute</button>
                    </div>
                
                    <div>
                        <h2>Right Answer</h2>
                        <label for="id_rightAnswerText">Right Answer:</label>
                        {{ form.rightAnswerText }}
                    </div>
                
                    <button type="submit">Save Question</button>
                </form>
            </section>
        </main>        
    </div>
    <footer>
        <p>&copy; 2024 AUEB LMS</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Handle adding new attribute forms
            document.getElementById('add-attribute').addEventListener('click', function() {
                var container = document.getElementById('attributes-container');
                var totalForms = document.getElementById('id_form-TOTAL_FORMS');
                var newForm = container.children[0].cloneNode(true);
                var formCount = parseInt(totalForms.value);
                totalForms.value = formCount + 1;
                var regex = new RegExp(`form-(\\d+)-`, 'g');
                newForm.innerHTML = newForm.innerHTML.replace(regex, `form-${formCount}-`);
                container.appendChild(newForm);
                
                // Attach the event listener to the new "X" button
                attachRemoveEvent(newForm.querySelector('.remove-attribute'));
            });

            // Attach remove event to existing forms
            document.querySelectorAll('.remove-attribute').forEach(attachRemoveEvent);

            function attachRemoveEvent(button) {
                button.addEventListener('click', function() {
                    var container = document.getElementById('attributes-container');
                    var form = this.parentElement;
                    var totalForms = document.getElementById('id_form-TOTAL_FORMS');
                    var formCount = parseInt(totalForms.value);

                    if (formCount > 1) {
                        form.remove();
                        totalForms.value = formCount - 1;
                    } else {
                        form.querySelector('input').value = ''; // Clear content if it's the only form
                    }
                });
            }
        });
    </script>
</body>
</html>