<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add a Question</title>
    <link rel="stylesheet" href="/static/css/addQuestion_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-container">
            <button class="home-button" onclick="location.href='/portfolio/'">
                <img src="/static/home.png" alt="Home">
            </button>
            <div class="header-right">
                <button onclick="location.href='/profile/'">{{ username }}</button>
                <button onclick="location.href='/'">Logout</button>
            </div>
        </div>
    </header>
    <div class="main-container">
        <aside>
            <div class="logo-container">
                <img src="/static/logo.png" alt="Logo">
            </div>
            <nav>
                <ul>
                    <li><a href="/portfolio/">My Tests</a></li>
                    <li><a href="/questions/">My Test Questions</a></li>
                    <!-- Dropdown list of tests -->
                </ul>
            </nav>
        </aside>
        <main>
            <section class="add_question">
                <h1>Add a Question</h1>
                <form method="post">
                    {% csrf_token %}
                    
                    <div>
                        <h2>Question Details</h2>
                        {{ form.non_field_errors }}
                        <div>
                            <label for="id_question">Question:</label>
                            {{ form.question }}
                        </div>
                        <div>
                            <label for="id_type">Type:</label>
                            {{ form.type }}
                        </div>
                        <div>
                            <label for="id_difficulty">Difficulty:</label>
                            {{ form.difficulty }}
                        </div>
                    </div>
                
                    <div>
                        <h2>Attributes</h2>
                        {{ formset.management_form }}
                        <div id="attributes-container">
                            {% for subform in formset %}
                                <div class="attribute-form">
                                    {{ subform.non_field_errors }}
                                    {{ subform.answer.label_tag }} {{ subform.answer }}
                                    {% if subform.instance.pk %}
                                        <label for="{{ subform.prefix }}-DELETE">Delete:</label>
                                        {{ subform.DELETE }}
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                        <button type="button" id="add-attribute">Add Another Attribute</button>
                    </div>
                
                    <div>
                        <h2>Right Answer</h2>
                        <label for="id_rightAnswerText">Right Answer:</label>
                        {{ form.rightAnswerText }}
                    </div>
                
                    <button type="submit">Save Question</button>
                </form>
            </section>
        </main>        
    </div>
    <footer>
        <p>&copy; 2024 AUEB LMS</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to handle adding new attribute forms
            document.getElementById('add-attribute').addEventListener('click', function() {
                var container = document.getElementById('attributes-container');
                var totalForms = document.getElementById('id_form-TOTAL_FORMS');
                var newForm = container.children[0].cloneNode(true);
                var formCount = parseInt(totalForms.value);
                totalForms.value = formCount + 1;
                var regex = new RegExp(`form-(\\d+)-`, 'g');
                newForm.innerHTML = newForm.innerHTML.replace(regex, `form-${formCount}-`);
                container.appendChild(newForm);
        
                // Add event listener to the new delete checkbox
                newForm.querySelector('.delete-attribute').addEventListener('change', function() {
                    if (this.checked) {
                        newForm.remove();
                    }
                });
            });

            // Function to handle the deletion of existing attribute forms
            const attributesContainer = document.getElementById('attributes-container');

            // Add event listener to existing delete checkboxes
            attributesContainer.querySelectorAll('.delete-attribute').forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        this.closest('.attribute-form').remove();
                    }
                });
            });
        });
    </script>
</body>
</html>