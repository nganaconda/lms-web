<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ test_name }} - Test</title>
    <link rel="stylesheet" href="/static/css/createdTest_analysis_style.css">
</head>
<body>
    <header>
        <div class="header-container">
            <button class="home-button" onclick="location.href='/portfolio/'">
                <img src="/static/home.png" alt="Home">
            </button>
            <div class="header-right">
                <button onclick="location.href='/profile/'">{{ username }}</button>
                <button onclick="location.href='/'">Logout</button>
            </div>
        </div>
    </header>
    <div class="main-container">
        <aside>
            <div class="logo-container">
                <img src="/static/logo.png" alt="Logo">
            </div>
            <nav>
                <ul>
                    <li><a href="/portfolio/">My Tests</a></li>
                    <li><a href="/questions/">My Test Questions</a></li>
                    <li><a href="/professor-grades/">My Students Grades</a></li>
                </ul>
            </nav>
        </aside>
        <main>
            <div class="remake-container">
                <a href="{% url 'remakeTest' test_gid=test_gid %}" class="remake-test-button">
                    <i class="fas fa-sync"></i> Remake the test
                </a>
            </div>
            <form id="weight-form" method="POST" action="{% url 'save_test_weights' test_gid=test_gid %}">
                {% csrf_token %}
                <section class="test">
                    <h1>{{ test_name }}</h1>
                    <p>Created at: {{ createdAt|date:"d/m/Y" }}</p>
                    
                    {% for question in questions_info %}
                        <div class="question">
                            <h2>{{ question.question_text }}</h2>
                                        
                            <div class="weight-input">
                                <label for="weight-{{ question.gid }}">Weight (0-1):</label>
                                <input type="number" id="weight-{{ forloop.counter0 }}" name="weights" step="0.01" min="0" max="1" value="{{ question.weight }}">
                            </div>
                            
                            <ul>
                                {% for attribute in question.attributes %}
                                    <li>
                                        <input type="radio" disabled>
                                        <label>{{ attribute.answer_text }}</label>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endfor %}
                </section>
                <div class="submit-container">
                    <button type="submit" class="submit-button">Save changes</button>
                </div>
                <div id="error-message" style="color: red;"></div>
            </form>
        </main>
    </div>
    <footer>
        <p>&copy; 2024 AUEB LMS</p>
    </footer>
</body>
</html>


<script>
    document.getElementById('weight-form').onsubmit = function(event) {
        // Prevent form submission
        event.preventDefault();

        // Get all weight inputs
        const weights = document.querySelectorAll('input[name="weights"]');
        let totalWeight = 0;

        // Sum up all the weights
        weights.forEach(function(weightInput) {
            const weight = parseFloat(weightInput.value);
            if (!isNaN(weight)) {
                totalWeight += weight;
            }
        });

        // Check if total weight equals 1
        if (totalWeight.toFixed(2) !== '1.00') {
            document.getElementById('error-message').textContent = 'The total weight must equal 1. Currently, it sums up to ' + totalWeight.toFixed(2);
        } else {
            // Submit the form if validation is successful
            event.target.submit();
        }
    };
</script>